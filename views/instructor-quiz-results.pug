extends layout

block content
  .page-container
    .page-header
      h1 üìä Results for "#{quiz.title}"
      p.subtitle View detailed analytics for all student attempts
    
    .stats-summary
      .stat-card
        .stat-icon üë•
        .stat-info
          .stat-value= attempts.length
          .stat-label Total Attempts
      
      .stat-card
        .stat-icon ‚≠ê
        .stat-info
          - var avgScore = attempts.length > 0 ? Math.round(attempts.reduce((sum, a) => sum + a.score, 0) / attempts.length) : 0
          .stat-value #{avgScore}%
          .stat-label Average Score
      
      .stat-card
        .stat-icon üèÜ
        .stat-info
          - var passedCount = attempts.filter(a => a.score >= 70).length
          .stat-value #{passedCount}
          .stat-label Passed (‚â•70%)
      
      .stat-card
        .stat-icon üìâ
        .stat-info
          - var failedCount = attempts.filter(a => a.score < 70).length
          .stat-value #{failedCount}
          .stat-label Failed (<70%)
    
    //- Utilise .table-container au lieu de .results-container
    .table-container
      if attempts && attempts.length > 0
        table.table-modern
          thead
            tr
              th STUDENT
              th EMAIL
              th SCORE
              th POINTS
              th TIME
              th DATE
              th ACTIONS
          tbody
            each attempt in attempts
              tr(class=attempt.score >= 70 ? 'pass' : 'fail')
                td.quiz-name
                  span.quiz-icon= attempt.student_name.charAt(0).toUpperCase()
                  = attempt.student_name
                
                td= attempt.student_email
                
                td.score-cell
                  .score-badge(class=attempt.score >= 90 ? 'excellent' : attempt.score >= 70 ? 'good' : 'needs-improvement')
                    span.score-value #{attempt.score}%
                
                td.score-cell
                  span.score-value #{attempt.total_points}
                  span.score-max  / #{attempt.max_points}
                
                td
                  if attempt.time_taken
                    - var minutes = Math.floor(attempt.time_taken / 60)
                    - var seconds = attempt.time_taken % 60
                    span #{minutes}m #{seconds}s
                  else
                    span N/A
                
                td.date-cell
                  .date-info
                    .date-main= new Date(attempt.created_at).toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' })
                    .date-time= new Date(attempt.created_at).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
                
                td
                  a.btn.btn-primary(href=`/instructor/attempts/${attempt.id}/details`) View Details
      else
        .empty-state
          .empty-icon üì≠
          h2 No Attempts Yet
          p Students haven't taken this quiz yet.
    
    .actions
      a.btn.btn-secondary(href='/instructor/quizzes') 
        span ‚Üê 
        | Back to Quizzes
